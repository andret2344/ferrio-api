{% extends 'base.html.twig' %}
{% block body %}
	<nav class="navbar bg-body-tertiary">
		<div class="container-fluid">
			<a class="navbar-brand">UHC Create UI</a>
			<div class="form-check form-switch">
				<label class="form-check-label" for="hideDescribedHolidays">Hide described holidays</label>
				<input class="form-check-input" type="checkbox" role="switch" id="hideDescribedHolidays">
			</div>
		</div>
	</nav>
	<section class='section-main'>
		<span class='heading my-5'>Welcome to creation UI!</span>
		<table class="table table-dark table-bordered">
			<caption>Translations</caption>
			<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col" style='min-width: 142px'>Country</th>
				<th scope="col">Month</th>
				<th scope="col">Day</th>
				<th scope="col" class='w-25'>Name</th>
				<th scope="col" class='w-75'>Description</th>
				<th scope="col">Action</th>
			</tr>
			</thead>
			<tbody>
			{% for element in fixed_holidays %}
				{% set form_id = 'form-' ~ element.id %}
				<form id='{{ form_id }}' method='post'>
					<input type='hidden' name='action' value='update' form='{{ form_id }}'/>
					<input type='hidden' name='metadata_id' value='{{ element.id }}' form='{{ form_id }}'/>
				</form>
				<tr class='tr-holiday'>
					<th scope="row">{{ element.id }}</th>
					<td>
						{% if element.countryName %}
							{{ element.countryCode }} - {{ element.countryName }}
						{% else %}
							International
						{% endif %}
					</td>
					<td>{{ element.month }}</td>
					<td>{{ element.day }}</td>
					<td>
						<label for='{{ 'name-' ~ element.id }}' class='d-none'>Name</label>
						<textarea
								style='min-height: 72px'
								name='name'
								class='w-100'
								form='{{ form_id }}'
								id='{{ 'name-' ~ element.id }}'
						>{{ element.name }}</textarea>
					</td>
					<td>
						<label for='{{ 'description-' ~ element.id }}' class='d-none'>Description</label>
						<textarea
								style='min-height: 72px'
								name='description'
								class='w-100 textarea-holiday-description'
								form='{{ form_id }}'
								id='{{ 'description-' ~ element.id }}'
						>{{ element.description }}</textarea>
					</td>
					<td><input type='submit' form='{{ form_id }}'></td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
		<form id='create' method='post'>
			<input type='hidden' name='action' value='create' form='create'/>
		</form>
		<table class='table table-dark table-bordered'>
			<caption>Adding</caption>
			<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Country</th>
				<th scope="col">Month</th>
				<th scope="col">Day</th>
				<th scope="col" class='w-25'>Name</th>
				<th scope="col" class='w-75'>Description</th>
				<th scope="col">Action</th>
			</tr>
			</thead>
			<tbody>
			<tr>
				<th scope="row">#</th>
				<td>
					<label for='country-create' class='d-none'>Country</label>
					<select
							id='country-create'
							class="selectpicker form-select"
							name='country'
							form='create'
					>
						<option value='null' selected>International</option>
						{% for country in countries %}
							<option value='{{ country.isoCode }}'>{{ country.isoCode }}
								- {{ country.englishName }}</option>
						{% endfor %}
					</select>
				</td>
				<td>
					<label for='month-create' class='d-none'>Month</label>
					<input
							required
							type='number'
							max='12'
							min='1'
							name='month'
							form='create'
							id='month-create'
					/>
				</td>
				<td>
					<label for='day-create' class='d-none'>Month</label>
					<input
							required
							type='number'
							max='31'
							min='1'
							name='day'
							form='create'
							id='day-create'
					/>
				</td>
				<td>
					<label for='name-create' class='d-none'>Name</label>
					<textarea
							required
							style='min-height: 72px'
							name='name'
							class='w-100'
							form='create'
							id='name-create'
					></textarea>
				</td>
				<td>
					<label for='description-create' class='d-none'>Description</label>
					<textarea
							style='min-height: 72px'
							name='description'
							class='w-100'
							form='create'
							id='description-create'
					></textarea>
				</td>
				<td><input type='submit' form='create'></td>
			</tr>
			</tbody>
		</table>
	</section>
	<script type='text/javascript'>
		const hidingSwitch = document.querySelector('#hideDescribedHolidays');
		if (localStorage.getItem('hide') === 'true') {
			hidingSwitch.checked = true;
		}
		showOrHide(!!hidingSwitch.checked);
		hidingSwitch.addEventListener('change', () => {
			const checked = hidingSwitch.checked;
			localStorage.setItem('hide', JSON.stringify(checked));
			showOrHide(checked);
		});

		function showOrHide(checked) {
			document.querySelectorAll('.tr-holiday').forEach(element => {
				const value = element.querySelector('.textarea-holiday-description').value;
				if (value) {
					if (checked) {
						element.classList.add('d-none');
					} else {
						element.classList.remove('d-none');
					}
				}
			});
		}
	</script>
{% endblock %}
